<!DOCTYPE html>
<html>
<head>
<title>Calculatrice Graphique JavaScript</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<style type="text/css">
body{margin:0px;}
label{display:block;float:left;margin-right:16px;text-align:right;width:100px;}
input{width:100px;}
#canvas{ubackground:#000;}
#param{position:absolute;top:0px;left:1000px;width:230px;padding:10px;text-align:justify;}
#calc{position:fixed;top:0px;left:0px;width:100%;height:100%;background:rgba(255,255,255,0.5);udisplay:none;}
#calc2{position:absolute;width:200px;height:20px;left:50%;margin-left:-100px;top:50%;margin-top:-10px;}
.fx{width:180px;}
</style>

</head>
<body>

<canvas id="canvas" width="1000" height="800"></canvas>
<form id="param">
Fonction :<br />
f(x) = <input id="formfx" type="text" onchange="fx=this.value;" class="fx">
<hr>
fenÃªtre<br>
<label for="formxmin">xmin</label><input id="formxmin" type="text" value="-2" onchange="xmin=parseInt(this.value);"><br>
<label for="formxmax">xmax</label><input id="formxmax" type="text" value="1" onchange="xmax=parseInt(this.value);"><br>
<label for="formymin">ymin</label><input id="formymin" type="text" value="-1.2" onchange="ymin=parseInt(this.value);"><br>
<label for="formymax">ymax</label><input id="formymax" type="text" value="1.2" onchange="ymax=parseInt(this.value);">
<hr>
<input type="button" value="Reinitialiser" onclick="reinit();"> <input type="button" value="1:1" onclick="ratio();">
<hr>
Canevas<br>
<label for="formlarg">largeur</label><input id="formlarg" type="text" value="1000" onchange="cwidth=parseInt(this.value);"><br>
<label for="formhaut">hauteur</label><input id="formhaut" type="text" value="800" onchange="cheight=parseInt(this.value);">
<hr>
<hr>
<input type="button" value="Calcul" onclick="draw();"><br>
<span id="disp"></span>
</form>
<div id="calc"><div id="calc2">calcul en cours...</div></div>

<script type="text/javascript">
var cwidth = 1000;
var cheight = 800;
var xmin = -2;document.getElementById("formxmin").value=xmin;
var xmax = 6;document.getElementById("formxmax").value=xmax;
var ymin = -3.2;document.getElementById("formymin").value=ymin;
var ymax = 3.2;document.getElementById("formymax").value=ymax;
var step = 1;
var dx = cwidth/(xmax-xmin);
var dy = cheight/(ymax-ymin);
var type = 1;
var d0,d1;
var fx="cos(x/2)+sin(x*2)";document.getElementById("formfx").value=fx;
function x2scr(x){
    return (x-xmin)*dx;
}
function y2scr(y){
    return (-y+ymax)*dy;
}
function scr2x(x){
    return xmin+x/dx;
}
function scr2y(y){
    return ymax-y/dy;
}
function cartline(x1,y1,x2,y2,c,ctx){
    ctx.beginPath();
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.strokeStyle = c;
    context.moveTo(x2scr(x1),y2scr(y1));
    context.lineTo(x2scr(x2),y2scr(y2));
    context.stroke();
}
function line(x1,y1,x2,y2,c,ctx){
    ctx.beginPath();
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.strokeStyle = c;
    context.moveTo(x1,y1);
    context.lineTo(x2,y2);
    context.stroke();
}
function drawgrid(ctx){
    for(var i=0;i<xmax;i+=step){
        var a = x2scr(i);
        line(a,0,a,cheight,"#ccc",ctx);
    }
    for(var i=0;i>xmin;i-=step){
        var a = x2scr(i);
        line(a,0,a,cheight,"#ccc",ctx);
    }
    for(var i=0;i<ymax;i+=step){
        var b = y2scr(i);
        line(0,b,cwidth,b,"#ccc",ctx);
    }
    for(var i=0;i>ymin;i-=step){
        var b = y2scr(i);
        line(0,b,cwidth,b,"#ccc",ctx);
    }
}
function drawaxis(ctx){
    var a,b;
    line(0,y2scr(0),cwidth,y2scr(0),"black",ctx);
    line(x2scr(0),0,x2scr(0),cheight,"black",ctx);
    b = y2scr(0);
    for(var i=0;i<xmax;i+=step){
        var a = x2scr(i);
        line(a,b,a,b-4,"black",ctx);
    }
    for(var i=0;i>xmin;i-=step){
        var a = x2scr(i);
        line(a,b,a,b-4,"black",ctx);
    }
    ctx.strokeText("x", cwidth-10, b-5);
    a = x2scr(0);
    for(var i=0;i<ymax;i+=step){
        var b = y2scr(i);
        line(a,b,a+4,b,"black",ctx);
    }
    for(var i=0;i>ymin;i-=step){
        var b = y2scr(i);
        line(a,b,a+4,b,"black",ctx);
    }
    ctx.strokeText("y", a+5, 10);
}
function cos(x){return Math.cos(x);}
function sin(x){return Math.sin(x);}
function tan(x){return Math.tan(x);}
function log(x,b){if(b===undefined){b=10;};return Math.log(x)/Math.log(b);}
function ln(x){return Math.log(x);}
function parsefx(f){
    f = f.replace("pi","Math.PI");
    return f;
}

function cartesien(){
    d0 = new Date();
    context = document.getElementById("canvas").getContext("2d");
    document.getElementById("canvas").width = cwidth;
    document.getElementById("canvas").height = cheight;
    document.getElementById("param").style.left = cwidth+"px";
    drawgrid(context);
    drawaxis(context);
    var i=0;
    var x = scr2x(i);
    fx2 = parsefx(fx);
    y = eval(fx2);
    context.lineJoin = "bevel";
    context.lineWidth = 1;
    context.beginPath();
    context.strokeStyle = "red";
    context.moveTo(i,y2scr(y));
    for(i=1;i<cwidth;i++){
        x = scr2x(i);
        y = eval(fx2);
        context.lineTo(i,y2scr(y));
    }
    context.stroke();
    d1 = new Date();
    var d = (d1-d0)/1000;
    document.getElementById("disp").innerHTML = "temps de calcul : "+d.toString()+"sec";
    document.getElementById("calc").style.display = "none";
    
}

function polaire(){
    
}

function calc(){
    document.getElementById("calc").style.display = "block";
    dx = cwidth/(xmax-xmin);
    dy = cheight/(ymax-ymin);
    switch(type){
        case 1:
        default:
            cartesien();
            break;
        case 2:
            polaire();
            break;
    }
}

function draw(){
    setTimeout("calc()", 10);
}

function reinit(){
    cwidth = 1000;document.getElementById("formlarg").value=cwidth;
    cheight = 800;document.getElementById("formhaut").value=cheight;
    xmin = -2;document.getElementById("formxmin").value=xmin;
    xmax = 6;document.getElementById("formxmax").value=xmax;
    ymin = -3.2;document.getElementById("formymin").value=ymin;
    ymax = 3.2;document.getElementById("formymax").value=ymax;
    dx = cwidth/(xmax-xmin);
    dy = cheight/(ymax-ymin);
    draw();
}
function ratio(){
    var dx = xmax-xmin;
    var dy = dx*cheight/cwidth;
    var y0 = (ymin+ymax)/2;
    ymin = y0-(dy/2);document.getElementById("formymin").value=ymin;
    ymax = y0+(dy/2);document.getElementById("formymax").value=ymax;
    draw();
}

var m_x = "0";
var m_y = "0";
var m_x0 = "0";
var m_y0 = "0";
function mousse_position (e) {
    m_x = (navigator.appName.substring(0,3) == "Net") ? e.pageX : event.clientX+document.body.scrollLeft;
    m_y = (navigator.appName.substring(0,3) == "Net") ? e.pageY : event.clientY+document.body.scrollTop;
}

function handle(delta) {
    var dx = xmax-xmin;
    var dy = ymax-ymin;
    var xs = (xmax-xmin)/cwidth;
    var ys = (ymax-ymin)/cheight;
    var x = parseInt(m_x);
    var y = parseInt(m_y);
    var cx = xmin + x*xs;
    var cy = ymax - y*ys;
    
    if (delta < 0){
        dx*=2;
        dy*=2;
    }else{
        dx/=2;
        dy/=2;
    }
    xmin = cx - dx/2;document.getElementById("formxmin").value=xmin;
    xmax = cx + dx/2;document.getElementById("formxmax").value=xmax;
    ymin = cy - dy/2;document.getElementById("formymin").value=ymin;
    ymax = cy + dy/2;document.getElementById("formymax").value=ymax;
    draw();
}

function wheel(event){
    var delta = 0;
    if (!event)
            event = window.event;
    if (event.wheelDelta){
            delta = event.wheelDelta/120;
            if (window.opera)
                    delta = -delta;
    } else if (event.detail) {
            delta = -event.detail/3;
    }
    if (delta)
            handle(delta);
    if (event.preventDefault)
            event.preventDefault();
    event.returnValue = false;
}

var context;
var img;
var mov=false;
function begin(event){
    m_x0 = m_x;
    m_y0 = m_y;
    context = document.getElementById("canvas").getContext("2d");
    img = context.getImageData(0, 0, cwidth, cheight);
    mov=true;
}
function move(event){
    if (!mov) return;
    var xs=(xmax-xmin)/cwidth;
    var ys=(ymax-ymin)/cheight;
    var mx=m_x-m_x0;
    var my=m_y-m_y0;
    var cx=- mx*xs;
    var cy=my*ys;
    document.getElementById("formxmin").value=xmin+cx;
    document.getElementById("formxmax").value=xmax+cx;
    document.getElementById("formymin").value=ymin+cy;
    document.getElementById("formymax").value=ymax+cy;
    context.clearRect(0,0,cwidth,cheight);
    context.putImageData(img,mx,my);
}
function end(event){
    mov=false;
    var xs = (xmax-xmin)/cwidth;
    var ys = (ymax-ymin)/cheight;
    var mx = m_x-m_x0;
    var my = m_y-m_y0;
    var cx = - mx*xs;
    var cy = my*ys;
    xmin+=cx;document.getElementById("formxmin").value=xmin;
    xmax+=cx;document.getElementById("formxmax").value=xmax;
    ymin+=cy;document.getElementById("formymin").value=ymin;
    ymax+=cy;document.getElementById("formymax").value=ymax;
    draw();
}

window.document.onmousemove = mousse_position;
if (window.addEventListener)
    document.getElementById("canvas").addEventListener('DOMMouseScroll', wheel, false);
document.getElementById("canvas").onmousewheel = wheel;
document.getElementById("canvas").onmousedown = begin;
document.getElementById("canvas").onmousemove = move;
document.getElementById("canvas").onmouseup = end;
draw();
</script>
</body>
</html>
